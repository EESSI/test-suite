# 2d circle of particles inside a box with LJ walls (based off examples/balance/in.balance)

variable        b index 0

variable        x index 50
variable        y index 20
variable        d index 20
variable        v index 5
variable        w index 2

units           lj
dimension       2
atom_style      atomic
boundary        f f p

lattice         hex 0.85
region          box block 0 $x 0 $y -0.5 0.5
create_box      1 box
region          circle sphere $(v_d/2+1) $(v_d/2/sqrt(3.0)+1) 0.0 $(v_d/2)
create_atoms    1 region circle
mass            1 1.0

velocity        all create 0.5 87287 loop geom
velocity        all set $v $w 0 sum yes

pair_style      lj/cut 2.5
pair_coeff      1 1 10.0 1.0 2.5

neighbor        0.3 bin
neigh_modify    delay 0 every 1 check yes

fix             1 all nve

fix             2 all wall/lj93 xlo 0.0 1 1 2.5 xhi $x 1 1 2.5
fix             3 all wall/lj93 ylo 0.0 1 1 2.5 yhi $y 1 1 2.5

comm_style      staggered zyx # zyx is hard coded for historic reasons (a variable order of cuts has been discussed but not yet implemented in ALL)
fix             5 all balance/all every 50 grid staggered global 0.9 0.003

#compute         1 all property/atom proc
#variable        p atom c_1%10
#dump            2 all custom 50 ./tmp/tmp.dump id v_p x y z
#
#log             balance_all.log

# momentum
compute         mom_1 all momentum
variable        px atom mass*vx
variable        py atom mass*vy
variable        pz atom mass*vz
compute         mom_2 all reduce sum v_px v_py v_pz

thermo_style    custom step time c_mom_1[*] c_mom_2[*] temp epair ke press f_5[*]
thermo          50

run             10000
